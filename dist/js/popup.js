(()=>{class t{constructor(){this.isListening=!1,this.currentTabId=null,this.toggleButton=document.getElementById("toggleVoice"),this.transcriptionDiv=document.getElementById("transcription"),this.responseDiv=document.getElementById("response"),this.statusIndicator=document.getElementById("status-indicator"),this.statusText=document.getElementById("status-text"),this.errorMessage=document.getElementById("error-message"),this.toggleButton.disabled=!0,this.init()}async init(){try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});this.currentTabId=t.id;if(!t.url||t.url.startsWith('chrome://'))throw new Error('This extension cannot be used on Chrome system pages');await chrome.scripting.executeScript({target:{tabId:this.currentTabId},files:["js/content.js"]}),this.toggleButton.addEventListener("click",(()=>this.toggleVoice())),await this.checkContentScript(),this.toggleButton.disabled=!1,this.updateStatus("ready","Ready")}catch(t){this.handleError("Initialization error",t)}}async checkContentScript(){try{const t=await chrome.tabs.sendMessage(this.currentTabId,{type:"PING"});if(!t||!t.success)throw new Error("Content script not ready")}catch(t){throw new Error("Failed to connect to content script. Please refresh the page and try again.")}}updateStatus(t,e){const s={ready:"#4CAF50",listening:"#2196F3",processing:"#FFC107",error:"#F44336"};this.statusIndicator.style.backgroundColor=s[t]||s.error,this.statusText.textContent=e||t}handleError(t,e){console.error(`${t}:`,e);const s=e.message||"An error occurred";this.errorMessage.textContent=s,this.errorMessage.classList.remove("hidden"),this.updateStatus("error","Error"),setTimeout((()=>{this.errorMessage.classList.add("hidden"),"Error"===this.statusText.textContent&&this.updateStatus("ready","Ready")}),5e3)}async toggleVoice(){if(this.isListening)try{await chrome.tabs.sendMessage(this.currentTabId,{type:"STOP_RECORDING"}),this.isListening=!1,this.toggleButton.textContent="Start Voice",this.updateStatus("ready","Ready")}catch(t){this.handleError("Error stopping recording",t)}else try{await this.checkContentScript();const t=await chrome.tabs.sendMessage(this.currentTabId,{type:"START_RECORDING"});if(!t.success)throw new Error(t.error||"Failed to start recording");this.isListening=!0,this.toggleButton.textContent="Stop Voice",this.updateStatus("listening","Listening...")}catch(t){this.handleError("Error starting recording",t)}}}document.addEventListener("DOMContentLoaded",(()=>{new t}))})();